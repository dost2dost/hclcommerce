{"ast":null,"code":"var KEYCODE_TO_CODE = require('../constants').keyboardevent.KEYCODE_TO_CODE;\n\nvar registerComponent = require('../core/component').registerComponent;\n\nvar THREE = require('../lib/three');\n\nvar utils = require('../utils/');\n\nvar bind = utils.bind;\nvar shouldCaptureKeyEvent = utils.shouldCaptureKeyEvent;\nvar CLAMP_VELOCITY = 0.00001;\nvar MAX_DELTA = 0.2;\nvar KEYS = ['KeyW', 'KeyA', 'KeyS', 'KeyD', 'ArrowUp', 'ArrowLeft', 'ArrowRight', 'ArrowDown'];\n/**\n * WASD component to control entities using WASD keys.\n */\n\nmodule.exports.Component = registerComponent('wasd-controls', {\n  schema: {\n    acceleration: {\n      default: 65\n    },\n    adAxis: {\n      default: 'x',\n      oneOf: ['x', 'y', 'z']\n    },\n    adEnabled: {\n      default: true\n    },\n    adInverted: {\n      default: false\n    },\n    enabled: {\n      default: true\n    },\n    fly: {\n      default: false\n    },\n    wsAxis: {\n      default: 'z',\n      oneOf: ['x', 'y', 'z']\n    },\n    wsEnabled: {\n      default: true\n    },\n    wsInverted: {\n      default: false\n    }\n  },\n  init: function () {\n    // To keep track of the pressed keys.\n    this.keys = {};\n    this.easing = 1.1;\n    this.velocity = new THREE.Vector3(); // Bind methods and add event listeners.\n\n    this.onBlur = bind(this.onBlur, this);\n    this.onFocus = bind(this.onFocus, this);\n    this.onKeyDown = bind(this.onKeyDown, this);\n    this.onKeyUp = bind(this.onKeyUp, this);\n    this.onVisibilityChange = bind(this.onVisibilityChange, this);\n    this.attachVisibilityEventListeners();\n  },\n  tick: function (time, delta) {\n    var data = this.data;\n    var el = this.el;\n    var velocity = this.velocity;\n\n    if (!velocity[data.adAxis] && !velocity[data.wsAxis] && isEmptyObject(this.keys)) {\n      return;\n    } // Update velocity.\n\n\n    delta = delta / 1000;\n    this.updateVelocity(delta);\n\n    if (!velocity[data.adAxis] && !velocity[data.wsAxis]) {\n      return;\n    } // Get movement vector and translate position.\n\n\n    el.object3D.position.add(this.getMovementVector(delta));\n  },\n  remove: function () {\n    this.removeKeyEventListeners();\n    this.removeVisibilityEventListeners();\n  },\n  play: function () {\n    this.attachKeyEventListeners();\n  },\n  pause: function () {\n    this.keys = {};\n    this.removeKeyEventListeners();\n  },\n  updateVelocity: function (delta) {\n    var acceleration;\n    var adAxis;\n    var adSign;\n    var data = this.data;\n    var keys = this.keys;\n    var velocity = this.velocity;\n    var wsAxis;\n    var wsSign;\n    adAxis = data.adAxis;\n    wsAxis = data.wsAxis; // If FPS too low, reset velocity.\n\n    if (delta > MAX_DELTA) {\n      velocity[adAxis] = 0;\n      velocity[wsAxis] = 0;\n      return;\n    } // https://gamedev.stackexchange.com/questions/151383/frame-rate-independant-movement-with-acceleration\n\n\n    var scaledEasing = Math.pow(1 / this.easing, delta * 60); // Velocity Easing.\n\n    if (velocity[adAxis] !== 0) {\n      velocity[adAxis] -= velocity[adAxis] * scaledEasing;\n    }\n\n    if (velocity[wsAxis] !== 0) {\n      velocity[wsAxis] -= velocity[wsAxis] * scaledEasing;\n    } // Clamp velocity easing.\n\n\n    if (Math.abs(velocity[adAxis]) < CLAMP_VELOCITY) {\n      velocity[adAxis] = 0;\n    }\n\n    if (Math.abs(velocity[wsAxis]) < CLAMP_VELOCITY) {\n      velocity[wsAxis] = 0;\n    }\n\n    if (!data.enabled) {\n      return;\n    } // Update velocity using keys pressed.\n\n\n    acceleration = data.acceleration;\n\n    if (data.adEnabled) {\n      adSign = data.adInverted ? -1 : 1;\n\n      if (keys.KeyA || keys.ArrowLeft) {\n        velocity[adAxis] -= adSign * acceleration * delta;\n      }\n\n      if (keys.KeyD || keys.ArrowRight) {\n        velocity[adAxis] += adSign * acceleration * delta;\n      }\n    }\n\n    if (data.wsEnabled) {\n      wsSign = data.wsInverted ? -1 : 1;\n\n      if (keys.KeyW || keys.ArrowUp) {\n        velocity[wsAxis] -= wsSign * acceleration * delta;\n      }\n\n      if (keys.KeyS || keys.ArrowDown) {\n        velocity[wsAxis] += wsSign * acceleration * delta;\n      }\n    }\n  },\n  getMovementVector: function () {\n    var directionVector = new THREE.Vector3(0, 0, 0);\n    var rotationEuler = new THREE.Euler(0, 0, 0, 'YXZ');\n    return function (delta) {\n      var rotation = this.el.getAttribute('rotation');\n      var velocity = this.velocity;\n      var xRotation;\n      directionVector.copy(velocity);\n      directionVector.multiplyScalar(delta); // Absolute.\n\n      if (!rotation) {\n        return directionVector;\n      }\n\n      xRotation = this.data.fly ? rotation.x : 0; // Transform direction relative to heading.\n\n      rotationEuler.set(THREE.Math.degToRad(xRotation), THREE.Math.degToRad(rotation.y), 0);\n      directionVector.applyEuler(rotationEuler);\n      return directionVector;\n    };\n  }(),\n  attachVisibilityEventListeners: function () {\n    window.addEventListener('blur', this.onBlur);\n    window.addEventListener('focus', this.onFocus);\n    document.addEventListener('visibilitychange', this.onVisibilityChange);\n  },\n  removeVisibilityEventListeners: function () {\n    window.removeEventListener('blur', this.onBlur);\n    window.removeEventListener('focus', this.onFocus);\n    document.removeEventListener('visibilitychange', this.onVisibilityChange);\n  },\n  attachKeyEventListeners: function () {\n    window.addEventListener('keydown', this.onKeyDown);\n    window.addEventListener('keyup', this.onKeyUp);\n  },\n  removeKeyEventListeners: function () {\n    window.removeEventListener('keydown', this.onKeyDown);\n    window.removeEventListener('keyup', this.onKeyUp);\n  },\n  onBlur: function () {\n    this.pause();\n  },\n  onFocus: function () {\n    this.play();\n  },\n  onVisibilityChange: function () {\n    if (document.hidden) {\n      this.onBlur();\n    } else {\n      this.onFocus();\n    }\n  },\n  onKeyDown: function (event) {\n    var code;\n\n    if (!shouldCaptureKeyEvent(event)) {\n      return;\n    }\n\n    code = event.code || KEYCODE_TO_CODE[event.keyCode];\n\n    if (KEYS.indexOf(code) !== -1) {\n      this.keys[code] = true;\n    }\n  },\n  onKeyUp: function (event) {\n    var code;\n    code = event.code || KEYCODE_TO_CODE[event.keyCode];\n    delete this.keys[code];\n  }\n});\n\nfunction isEmptyObject(keys) {\n  var key;\n\n  for (key in keys) {\n    return false;\n  }\n\n  return true;\n}","map":{"version":3,"sources":["C:/Users/Hannuri/Desktop/RoyalCyber/my-first-app/node_modules/aframe/src/components/wasd-controls.js"],"names":["KEYCODE_TO_CODE","require","keyboardevent","registerComponent","THREE","utils","bind","shouldCaptureKeyEvent","CLAMP_VELOCITY","MAX_DELTA","KEYS","module","exports","Component","schema","acceleration","default","adAxis","oneOf","adEnabled","adInverted","enabled","fly","wsAxis","wsEnabled","wsInverted","init","keys","easing","velocity","Vector3","onBlur","onFocus","onKeyDown","onKeyUp","onVisibilityChange","attachVisibilityEventListeners","tick","time","delta","data","el","isEmptyObject","updateVelocity","object3D","position","add","getMovementVector","remove","removeKeyEventListeners","removeVisibilityEventListeners","play","attachKeyEventListeners","pause","adSign","wsSign","scaledEasing","Math","pow","abs","KeyA","ArrowLeft","KeyD","ArrowRight","KeyW","ArrowUp","KeyS","ArrowDown","directionVector","rotationEuler","Euler","rotation","getAttribute","xRotation","copy","multiplyScalar","x","set","degToRad","y","applyEuler","window","addEventListener","document","removeEventListener","hidden","event","code","keyCode","indexOf","key"],"mappings":"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","sourcesContent":["var KEYCODE_TO_CODE = require('../constants').keyboardevent.KEYCODE_TO_CODE;\nvar registerComponent = require('../core/component').registerComponent;\nvar THREE = require('../lib/three');\nvar utils = require('../utils/');\n\nvar bind = utils.bind;\nvar shouldCaptureKeyEvent = utils.shouldCaptureKeyEvent;\n\nvar CLAMP_VELOCITY = 0.00001;\nvar MAX_DELTA = 0.2;\nvar KEYS = [\n  'KeyW', 'KeyA', 'KeyS', 'KeyD',\n  'ArrowUp', 'ArrowLeft', 'ArrowRight', 'ArrowDown'\n];\n\n/**\n * WASD component to control entities using WASD keys.\n */\nmodule.exports.Component = registerComponent('wasd-controls', {\n  schema: {\n    acceleration: {default: 65},\n    adAxis: {default: 'x', oneOf: ['x', 'y', 'z']},\n    adEnabled: {default: true},\n    adInverted: {default: false},\n    enabled: {default: true},\n    fly: {default: false},\n    wsAxis: {default: 'z', oneOf: ['x', 'y', 'z']},\n    wsEnabled: {default: true},\n    wsInverted: {default: false}\n  },\n\n  init: function () {\n    // To keep track of the pressed keys.\n    this.keys = {};\n    this.easing = 1.1;\n\n    this.velocity = new THREE.Vector3();\n\n    // Bind methods and add event listeners.\n    this.onBlur = bind(this.onBlur, this);\n    this.onFocus = bind(this.onFocus, this);\n    this.onKeyDown = bind(this.onKeyDown, this);\n    this.onKeyUp = bind(this.onKeyUp, this);\n    this.onVisibilityChange = bind(this.onVisibilityChange, this);\n    this.attachVisibilityEventListeners();\n  },\n\n  tick: function (time, delta) {\n    var data = this.data;\n    var el = this.el;\n    var velocity = this.velocity;\n\n    if (!velocity[data.adAxis] && !velocity[data.wsAxis] &&\n        isEmptyObject(this.keys)) { return; }\n\n    // Update velocity.\n    delta = delta / 1000;\n    this.updateVelocity(delta);\n\n    if (!velocity[data.adAxis] && !velocity[data.wsAxis]) { return; }\n\n    // Get movement vector and translate position.\n    el.object3D.position.add(this.getMovementVector(delta));\n  },\n\n  remove: function () {\n    this.removeKeyEventListeners();\n    this.removeVisibilityEventListeners();\n  },\n\n  play: function () {\n    this.attachKeyEventListeners();\n  },\n\n  pause: function () {\n    this.keys = {};\n    this.removeKeyEventListeners();\n  },\n\n  updateVelocity: function (delta) {\n    var acceleration;\n    var adAxis;\n    var adSign;\n    var data = this.data;\n    var keys = this.keys;\n    var velocity = this.velocity;\n    var wsAxis;\n    var wsSign;\n\n    adAxis = data.adAxis;\n    wsAxis = data.wsAxis;\n\n    // If FPS too low, reset velocity.\n    if (delta > MAX_DELTA) {\n      velocity[adAxis] = 0;\n      velocity[wsAxis] = 0;\n      return;\n    }\n\n    // https://gamedev.stackexchange.com/questions/151383/frame-rate-independant-movement-with-acceleration\n    var scaledEasing = Math.pow(1 / this.easing, delta * 60);\n    // Velocity Easing.\n    if (velocity[adAxis] !== 0) {\n      velocity[adAxis] -= velocity[adAxis] * scaledEasing;\n    }\n    if (velocity[wsAxis] !== 0) {\n      velocity[wsAxis] -= velocity[wsAxis] * scaledEasing;\n    }\n\n    // Clamp velocity easing.\n    if (Math.abs(velocity[adAxis]) < CLAMP_VELOCITY) { velocity[adAxis] = 0; }\n    if (Math.abs(velocity[wsAxis]) < CLAMP_VELOCITY) { velocity[wsAxis] = 0; }\n\n    if (!data.enabled) { return; }\n\n    // Update velocity using keys pressed.\n    acceleration = data.acceleration;\n    if (data.adEnabled) {\n      adSign = data.adInverted ? -1 : 1;\n      if (keys.KeyA || keys.ArrowLeft) { velocity[adAxis] -= adSign * acceleration * delta; }\n      if (keys.KeyD || keys.ArrowRight) { velocity[adAxis] += adSign * acceleration * delta; }\n    }\n    if (data.wsEnabled) {\n      wsSign = data.wsInverted ? -1 : 1;\n      if (keys.KeyW || keys.ArrowUp) { velocity[wsAxis] -= wsSign * acceleration * delta; }\n      if (keys.KeyS || keys.ArrowDown) { velocity[wsAxis] += wsSign * acceleration * delta; }\n    }\n  },\n\n  getMovementVector: (function () {\n    var directionVector = new THREE.Vector3(0, 0, 0);\n    var rotationEuler = new THREE.Euler(0, 0, 0, 'YXZ');\n\n    return function (delta) {\n      var rotation = this.el.getAttribute('rotation');\n      var velocity = this.velocity;\n      var xRotation;\n\n      directionVector.copy(velocity);\n      directionVector.multiplyScalar(delta);\n\n      // Absolute.\n      if (!rotation) { return directionVector; }\n\n      xRotation = this.data.fly ? rotation.x : 0;\n\n      // Transform direction relative to heading.\n      rotationEuler.set(THREE.Math.degToRad(xRotation), THREE.Math.degToRad(rotation.y), 0);\n      directionVector.applyEuler(rotationEuler);\n      return directionVector;\n    };\n  })(),\n\n  attachVisibilityEventListeners: function () {\n    window.addEventListener('blur', this.onBlur);\n    window.addEventListener('focus', this.onFocus);\n    document.addEventListener('visibilitychange', this.onVisibilityChange);\n  },\n\n  removeVisibilityEventListeners: function () {\n    window.removeEventListener('blur', this.onBlur);\n    window.removeEventListener('focus', this.onFocus);\n    document.removeEventListener('visibilitychange', this.onVisibilityChange);\n  },\n\n  attachKeyEventListeners: function () {\n    window.addEventListener('keydown', this.onKeyDown);\n    window.addEventListener('keyup', this.onKeyUp);\n  },\n\n  removeKeyEventListeners: function () {\n    window.removeEventListener('keydown', this.onKeyDown);\n    window.removeEventListener('keyup', this.onKeyUp);\n  },\n\n  onBlur: function () {\n    this.pause();\n  },\n\n  onFocus: function () {\n    this.play();\n  },\n\n  onVisibilityChange: function () {\n    if (document.hidden) {\n      this.onBlur();\n    } else {\n      this.onFocus();\n    }\n  },\n\n  onKeyDown: function (event) {\n    var code;\n    if (!shouldCaptureKeyEvent(event)) { return; }\n    code = event.code || KEYCODE_TO_CODE[event.keyCode];\n    if (KEYS.indexOf(code) !== -1) { this.keys[code] = true; }\n  },\n\n  onKeyUp: function (event) {\n    var code;\n    code = event.code || KEYCODE_TO_CODE[event.keyCode];\n    delete this.keys[code];\n  }\n});\n\nfunction isEmptyObject (keys) {\n  var key;\n  for (key in keys) { return false; }\n  return true;\n}\n"]},"metadata":{},"sourceType":"script"}