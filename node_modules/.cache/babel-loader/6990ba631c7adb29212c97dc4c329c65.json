{"ast":null,"code":"/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Vector3 } from 'three';\n/**\n * Moves Three.js objects from one parent to another\n */\n\nexport const moveChildren = (from, to) => {\n  while (from.children.length) {\n    to.add(from.children.shift());\n  }\n};\n/**\n * Performs a reduction across all the vertices of the input model and all its\n * children. The supplied function takes the reduced value and a vertex and\n * returns the newly reduced value. The value is initialized as zero.\n *\n * Adapted from Three.js, @see https://github.com/mrdoob/three.js/blob/7e0a78beb9317e580d7fa4da9b5b12be051c6feb/src/math/Box3.js#L241\n */\n\nexport const reduceVertices = (model, func) => {\n  let value = 0;\n  const vector = new Vector3();\n  model.traverse(object => {\n    let i, l;\n    object.updateWorldMatrix(false, false);\n    let geometry = object.geometry;\n\n    if (geometry !== undefined) {\n      if (geometry.isGeometry) {\n        let vertices = geometry.vertices;\n\n        for (i = 0, l = vertices.length; i < l; i++) {\n          vector.copy(vertices[i]);\n          vector.applyMatrix4(object.matrixWorld);\n          value = func(value, vector);\n        }\n      } else if (geometry.isBufferGeometry) {\n        let attribute = geometry.attributes.position;\n\n        if (attribute !== undefined) {\n          for (i = 0, l = attribute.count; i < l; i++) {\n            vector.fromBufferAttribute(attribute, i).applyMatrix4(object.matrixWorld);\n            value = func(value, vector);\n          }\n        }\n      }\n    }\n  });\n  return value;\n};","map":{"version":3,"sources":["../../src/three-components/ModelUtils.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;AAcA,SAAkB,OAAlB,QAAgC,OAAhC;AAEA;;;;AAGA,OAAO,MAAM,YAAY,GAAG,CAAC,IAAD,EAAiB,EAAjB,KAAiC;AAC3D,SAAO,IAAI,CAAC,QAAL,CAAc,MAArB,EAA6B;AAC3B,IAAA,EAAE,CAAC,GAAH,CAAO,IAAI,CAAC,QAAL,CAAc,KAAd,EAAP;AACD;AACF,CAJM;AAMP;;;;;;;;AAOA,OAAO,MAAM,cAAc,GACvB,CAAC,KAAD,EAAkB,IAAlB,KACa;AACP,MAAI,KAAK,GAAG,CAAZ;AACA,QAAM,MAAM,GAAG,IAAI,OAAJ,EAAf;AACA,EAAA,KAAK,CAAC,QAAN,CAAgB,MAAD,IAAgB;AAC7B,QAAI,CAAJ,EAAO,CAAP;AAEA,IAAA,MAAM,CAAC,iBAAP,CAAyB,KAAzB,EAAgC,KAAhC;AAEA,QAAI,QAAQ,GAAG,MAAM,CAAC,QAAtB;;AAEA,QAAI,QAAQ,KAAK,SAAjB,EAA4B;AAC1B,UAAI,QAAQ,CAAC,UAAb,EAAyB;AACvB,YAAI,QAAQ,GAAG,QAAQ,CAAC,QAAxB;;AAEA,aAAK,CAAC,GAAG,CAAJ,EAAO,CAAC,GAAG,QAAQ,CAAC,MAAzB,EAAiC,CAAC,GAAG,CAArC,EAAwC,CAAC,EAAzC,EAA6C;AAC3C,UAAA,MAAM,CAAC,IAAP,CAAY,QAAQ,CAAC,CAAD,CAApB;AACA,UAAA,MAAM,CAAC,YAAP,CAAoB,MAAM,CAAC,WAA3B;AAEA,UAAA,KAAK,GAAG,IAAI,CAAC,KAAD,EAAQ,MAAR,CAAZ;AACD;AAEF,OAVD,MAUO,IAAI,QAAQ,CAAC,gBAAb,EAA+B;AACpC,YAAI,SAAS,GAAG,QAAQ,CAAC,UAAT,CAAoB,QAApC;;AAEA,YAAI,SAAS,KAAK,SAAlB,EAA6B;AAC3B,eAAK,CAAC,GAAG,CAAJ,EAAO,CAAC,GAAG,SAAS,CAAC,KAA1B,EAAiC,CAAC,GAAG,CAArC,EAAwC,CAAC,EAAzC,EAA6C;AAC3C,YAAA,MAAM,CAAC,mBAAP,CAA2B,SAA3B,EAAsC,CAAtC,EACK,YADL,CACkB,MAAM,CAAC,WADzB;AAGA,YAAA,KAAK,GAAG,IAAI,CAAC,KAAD,EAAQ,MAAR,CAAZ;AACD;AACF;AACF;AACF;AACF,GA/BD;AAgCA,SAAO,KAAP;AACD,CAtCF","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {Object3D, Vector3} from 'three';\n\n/**\n * Moves Three.js objects from one parent to another\n */\nexport const moveChildren = (from: Object3D, to: Object3D) => {\n  while (from.children.length) {\n    to.add(from.children.shift()!);\n  }\n};\n\n/**\n * Performs a reduction across all the vertices of the input model and all its\n * children. The supplied function takes the reduced value and a vertex and\n * returns the newly reduced value. The value is initialized as zero.\n *\n * Adapted from Three.js, @see https://github.com/mrdoob/three.js/blob/7e0a78beb9317e580d7fa4da9b5b12be051c6feb/src/math/Box3.js#L241\n */\nexport const reduceVertices =\n    (model: Object3D, func: (value: number, vertex: Vector3) => number):\n        number => {\n          let value = 0;\n          const vector = new Vector3();\n          model.traverse((object: any) => {\n            let i, l;\n\n            object.updateWorldMatrix(false, false);\n\n            let geometry = object.geometry;\n\n            if (geometry !== undefined) {\n              if (geometry.isGeometry) {\n                let vertices = geometry.vertices;\n\n                for (i = 0, l = vertices.length; i < l; i++) {\n                  vector.copy(vertices[i]);\n                  vector.applyMatrix4(object.matrixWorld);\n\n                  value = func(value, vector);\n                }\n\n              } else if (geometry.isBufferGeometry) {\n                let attribute = geometry.attributes.position;\n\n                if (attribute !== undefined) {\n                  for (i = 0, l = attribute.count; i < l; i++) {\n                    vector.fromBufferAttribute(attribute, i)\n                        .applyMatrix4(object.matrixWorld);\n\n                    value = func(value, vector);\n                  }\n                }\n              }\n            }\n          });\n          return value;\n        };\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}