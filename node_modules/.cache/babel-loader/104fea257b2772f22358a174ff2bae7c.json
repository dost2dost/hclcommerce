{"ast":null,"code":"var registerComponent = require('../core/component').registerComponent;\n\nvar bind = require('../utils/bind');\n\nvar trackedControlsUtils = require('../utils/tracked-controls');\n\nvar checkControllerPresentAndSetup = trackedControlsUtils.checkControllerPresentAndSetup;\nvar emitIfAxesChanged = trackedControlsUtils.emitIfAxesChanged;\nvar onButtonEvent = trackedControlsUtils.onButtonEvent;\n\nvar isWebXRAvailable = require('../utils/').device.isWebXRAvailable;\n\nvar GAMEPAD_ID_WEBXR = 'oculus-go';\nvar GAMEPAD_ID_WEBVR = 'Oculus Go';\nvar OCULUS_GO_CONTROLLER_MODEL_URL = 'https://cdn.aframe.io/controllers/oculus/go/oculus-go-controller.gltf'; // Prefix for Gen1 and Gen2 Oculus Touch Controllers.\n\nvar GAMEPAD_ID_PREFIX = isWebXRAvailable ? GAMEPAD_ID_WEBXR : GAMEPAD_ID_WEBVR;\n/**\n * Button indices:\n * 0 - trackpad\n * 1 - trigger\n *\n * Axis:\n * 0 - trackpad x\n * 1 - trackpad y\n */\n\nvar INPUT_MAPPING_WEBVR = {\n  axes: {\n    trackpad: [0, 1]\n  },\n  buttons: ['trackpad', 'trigger']\n};\n/**\n * Button indices:\n * 0 - trigger\n * 1 - none\n * 2 - touchpad\n *\n * Axis:\n * 0 - touchpad x\n * 1 - touchpad y\n * Reference: https://github.com/immersive-web/webxr-input-profiles/blob/master/packages/registry/profiles/oculus/oculus-go.json\n */\n\nvar INPUT_MAPPING_WEBXR = {\n  left: {\n    axes: {\n      touchpad: [0, 1]\n    },\n    buttons: ['trigger', 'none', 'touchpad']\n  },\n  right: {\n    axes: {\n      touchpad: [0, 1]\n    },\n    buttons: ['trigger', 'none', 'touchpad']\n  }\n};\nvar INPUT_MAPPING = isWebXRAvailable ? INPUT_MAPPING_WEBXR : INPUT_MAPPING_WEBVR;\n/**\n * Oculus Go controls.\n * Interface with Oculus Go controller and map Gamepad events to\n * controller buttons: trackpad, trigger\n * Load a controller model and highlight the pressed buttons.\n */\n\nmodule.exports.Component = registerComponent('oculus-go-controls', {\n  schema: {\n    hand: {\n      default: ''\n    },\n    // This informs the degenerate arm model.\n    buttonColor: {\n      type: 'color',\n      default: '#FFFFFF'\n    },\n    buttonTouchedColor: {\n      type: 'color',\n      default: '#BBBBBB'\n    },\n    buttonHighlightColor: {\n      type: 'color',\n      default: '#7A7A7A'\n    },\n    model: {\n      default: true\n    },\n    orientationOffset: {\n      type: 'vec3'\n    },\n    armModel: {\n      default: true\n    }\n  },\n\n  /**\n   * Button IDs:\n   * 0 - trackpad\n   * 1 - trigger\n   */\n  mapping: INPUT_MAPPING,\n  bindMethods: function () {\n    this.onModelLoaded = bind(this.onModelLoaded, this);\n    this.onControllersUpdate = bind(this.onControllersUpdate, this);\n    this.checkIfControllerPresent = bind(this.checkIfControllerPresent, this);\n    this.removeControllersUpdateListener = bind(this.removeControllersUpdateListener, this);\n    this.onAxisMoved = bind(this.onAxisMoved, this);\n  },\n  init: function () {\n    var self = this;\n    this.onButtonChanged = bind(this.onButtonChanged, this);\n\n    this.onButtonDown = function (evt) {\n      onButtonEvent(evt.detail.id, 'down', self);\n    };\n\n    this.onButtonUp = function (evt) {\n      onButtonEvent(evt.detail.id, 'up', self);\n    };\n\n    this.onButtonTouchStart = function (evt) {\n      onButtonEvent(evt.detail.id, 'touchstart', self);\n    };\n\n    this.onButtonTouchEnd = function (evt) {\n      onButtonEvent(evt.detail.id, 'touchend', self);\n    };\n\n    this.controllerPresent = false;\n    this.lastControllerCheck = 0;\n    this.rendererSystem = this.el.sceneEl.systems.renderer;\n    this.bindMethods();\n  },\n  addEventListeners: function () {\n    var el = this.el;\n    el.addEventListener('buttonchanged', this.onButtonChanged);\n    el.addEventListener('buttondown', this.onButtonDown);\n    el.addEventListener('buttonup', this.onButtonUp);\n    el.addEventListener('touchstart', this.onButtonTouchStart);\n    el.addEventListener('touchend', this.onButtonTouchEnd);\n    el.addEventListener('model-loaded', this.onModelLoaded);\n    el.addEventListener('axismove', this.onAxisMoved);\n    this.controllerEventsActive = true;\n  },\n  removeEventListeners: function () {\n    var el = this.el;\n    el.removeEventListener('buttonchanged', this.onButtonChanged);\n    el.removeEventListener('buttondown', this.onButtonDown);\n    el.removeEventListener('buttonup', this.onButtonUp);\n    el.removeEventListener('touchstart', this.onButtonTouchStart);\n    el.removeEventListener('touchend', this.onButtonTouchEnd);\n    el.removeEventListener('model-loaded', this.onModelLoaded);\n    el.removeEventListener('axismove', this.onAxisMoved);\n    this.controllerEventsActive = false;\n  },\n  checkIfControllerPresent: function () {\n    checkControllerPresentAndSetup(this, GAMEPAD_ID_PREFIX, this.data.hand ? {\n      hand: this.data.hand\n    } : {});\n  },\n  play: function () {\n    this.checkIfControllerPresent();\n    this.addControllersUpdateListener();\n  },\n  pause: function () {\n    this.removeEventListeners();\n    this.removeControllersUpdateListener();\n  },\n  injectTrackedControls: function () {\n    var el = this.el;\n    var data = this.data;\n    el.setAttribute('tracked-controls', {\n      armModel: data.armModel,\n      hand: data.hand,\n      idPrefix: GAMEPAD_ID_PREFIX,\n      orientationOffset: data.orientationOffset\n    });\n\n    if (!this.data.model) {\n      return;\n    }\n\n    this.el.setAttribute('gltf-model', OCULUS_GO_CONTROLLER_MODEL_URL);\n  },\n  addControllersUpdateListener: function () {\n    this.el.sceneEl.addEventListener('controllersupdated', this.onControllersUpdate, false);\n  },\n  removeControllersUpdateListener: function () {\n    this.el.sceneEl.removeEventListener('controllersupdated', this.onControllersUpdate, false);\n  },\n  onControllersUpdate: function () {\n    this.checkIfControllerPresent();\n  },\n  // No need for onButtonChanged, since Oculus Go controller has no analog buttons.\n  onModelLoaded: function (evt) {\n    var controllerObject3D = evt.detail.model;\n    var buttonMeshes;\n\n    if (!this.data.model) {\n      return;\n    }\n\n    buttonMeshes = this.buttonMeshes = {};\n    buttonMeshes.trigger = controllerObject3D.getObjectByName('oculus_go_button_trigger');\n    buttonMeshes.trackpad = controllerObject3D.getObjectByName('oculus_go_touchpad');\n  },\n  onButtonChanged: function (evt) {\n    var button = this.mapping.buttons[evt.detail.id];\n    if (!button) return; // Pass along changed event with button state, using button mapping for convenience.\n\n    this.el.emit(button + 'changed', evt.detail.state);\n  },\n  onAxisMoved: function (evt) {\n    emitIfAxesChanged(this, this.mapping.axes, evt);\n  },\n  updateModel: function (buttonName, evtName) {\n    if (!this.data.model) {\n      return;\n    }\n\n    this.updateButtonModel(buttonName, evtName);\n  },\n  updateButtonModel: function (buttonName, state) {\n    var buttonMeshes = this.buttonMeshes;\n\n    if (!buttonMeshes || !buttonMeshes[buttonName]) {\n      return;\n    }\n\n    var color;\n    var button;\n\n    switch (state) {\n      case 'down':\n        color = this.data.buttonHighlightColor;\n        break;\n\n      case 'touchstart':\n        color = this.data.buttonTouchedColor;\n        break;\n\n      default:\n        color = this.data.buttonColor;\n    }\n\n    button = buttonMeshes[buttonName];\n    button.material.color.set(color);\n    this.rendererSystem.applyColorCorrection(button.material.color);\n  }\n});","map":{"version":3,"sources":["C:/Users/Hannuri/Desktop/RoyalCyber/my-first-app/node_modules/aframe/src/components/oculus-go-controls.js"],"names":["registerComponent","require","bind","trackedControlsUtils","checkControllerPresentAndSetup","emitIfAxesChanged","onButtonEvent","isWebXRAvailable","device","GAMEPAD_ID_WEBXR","GAMEPAD_ID_WEBVR","OCULUS_GO_CONTROLLER_MODEL_URL","GAMEPAD_ID_PREFIX","INPUT_MAPPING_WEBVR","axes","trackpad","buttons","INPUT_MAPPING_WEBXR","left","touchpad","right","INPUT_MAPPING","module","exports","Component","schema","hand","default","buttonColor","type","buttonTouchedColor","buttonHighlightColor","model","orientationOffset","armModel","mapping","bindMethods","onModelLoaded","onControllersUpdate","checkIfControllerPresent","removeControllersUpdateListener","onAxisMoved","init","self","onButtonChanged","onButtonDown","evt","detail","id","onButtonUp","onButtonTouchStart","onButtonTouchEnd","controllerPresent","lastControllerCheck","rendererSystem","el","sceneEl","systems","renderer","addEventListeners","addEventListener","controllerEventsActive","removeEventListeners","removeEventListener","data","play","addControllersUpdateListener","pause","injectTrackedControls","setAttribute","idPrefix","controllerObject3D","buttonMeshes","trigger","getObjectByName","button","emit","state","updateModel","buttonName","evtName","updateButtonModel","color","material","set","applyColorCorrection"],"mappings":"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","sourcesContent":["var registerComponent = require('../core/component').registerComponent;\nvar bind = require('../utils/bind');\n\nvar trackedControlsUtils = require('../utils/tracked-controls');\nvar checkControllerPresentAndSetup = trackedControlsUtils.checkControllerPresentAndSetup;\nvar emitIfAxesChanged = trackedControlsUtils.emitIfAxesChanged;\nvar onButtonEvent = trackedControlsUtils.onButtonEvent;\nvar isWebXRAvailable = require('../utils/').device.isWebXRAvailable;\n\nvar GAMEPAD_ID_WEBXR = 'oculus-go';\nvar GAMEPAD_ID_WEBVR = 'Oculus Go';\n\nvar OCULUS_GO_CONTROLLER_MODEL_URL = 'https://cdn.aframe.io/controllers/oculus/go/oculus-go-controller.gltf';\n\n// Prefix for Gen1 and Gen2 Oculus Touch Controllers.\nvar GAMEPAD_ID_PREFIX = isWebXRAvailable ? GAMEPAD_ID_WEBXR : GAMEPAD_ID_WEBVR;\n\n/**\n * Button indices:\n * 0 - trackpad\n * 1 - trigger\n *\n * Axis:\n * 0 - trackpad x\n * 1 - trackpad y\n */\nvar INPUT_MAPPING_WEBVR = {\n  axes: {trackpad: [0, 1]},\n  buttons: ['trackpad', 'trigger']\n};\n\n/**\n * Button indices:\n * 0 - trigger\n * 1 - none\n * 2 - touchpad\n *\n * Axis:\n * 0 - touchpad x\n * 1 - touchpad y\n * Reference: https://github.com/immersive-web/webxr-input-profiles/blob/master/packages/registry/profiles/oculus/oculus-go.json\n */\nvar INPUT_MAPPING_WEBXR = {\n  left: {\n    axes: {touchpad: [0, 1]},\n    buttons: ['trigger', 'none', 'touchpad']\n  },\n  right: {\n    axes: {touchpad: [0, 1]},\n    buttons: ['trigger', 'none', 'touchpad']\n  }\n};\n\nvar INPUT_MAPPING = isWebXRAvailable ? INPUT_MAPPING_WEBXR : INPUT_MAPPING_WEBVR;\n\n/**\n * Oculus Go controls.\n * Interface with Oculus Go controller and map Gamepad events to\n * controller buttons: trackpad, trigger\n * Load a controller model and highlight the pressed buttons.\n */\nmodule.exports.Component = registerComponent('oculus-go-controls', {\n  schema: {\n    hand: {default: ''},  // This informs the degenerate arm model.\n    buttonColor: {type: 'color', default: '#FFFFFF'},\n    buttonTouchedColor: {type: 'color', default: '#BBBBBB'},\n    buttonHighlightColor: {type: 'color', default: '#7A7A7A'},\n    model: {default: true},\n    orientationOffset: {type: 'vec3'},\n    armModel: {default: true}\n  },\n\n  /**\n   * Button IDs:\n   * 0 - trackpad\n   * 1 - trigger\n   */\n  mapping: INPUT_MAPPING,\n\n  bindMethods: function () {\n    this.onModelLoaded = bind(this.onModelLoaded, this);\n    this.onControllersUpdate = bind(this.onControllersUpdate, this);\n    this.checkIfControllerPresent = bind(this.checkIfControllerPresent, this);\n    this.removeControllersUpdateListener = bind(this.removeControllersUpdateListener, this);\n    this.onAxisMoved = bind(this.onAxisMoved, this);\n  },\n\n  init: function () {\n    var self = this;\n    this.onButtonChanged = bind(this.onButtonChanged, this);\n    this.onButtonDown = function (evt) { onButtonEvent(evt.detail.id, 'down', self); };\n    this.onButtonUp = function (evt) { onButtonEvent(evt.detail.id, 'up', self); };\n    this.onButtonTouchStart = function (evt) { onButtonEvent(evt.detail.id, 'touchstart', self); };\n    this.onButtonTouchEnd = function (evt) { onButtonEvent(evt.detail.id, 'touchend', self); };\n    this.controllerPresent = false;\n    this.lastControllerCheck = 0;\n    this.rendererSystem = this.el.sceneEl.systems.renderer;\n    this.bindMethods();\n  },\n\n  addEventListeners: function () {\n    var el = this.el;\n    el.addEventListener('buttonchanged', this.onButtonChanged);\n    el.addEventListener('buttondown', this.onButtonDown);\n    el.addEventListener('buttonup', this.onButtonUp);\n    el.addEventListener('touchstart', this.onButtonTouchStart);\n    el.addEventListener('touchend', this.onButtonTouchEnd);\n    el.addEventListener('model-loaded', this.onModelLoaded);\n    el.addEventListener('axismove', this.onAxisMoved);\n    this.controllerEventsActive = true;\n  },\n\n  removeEventListeners: function () {\n    var el = this.el;\n    el.removeEventListener('buttonchanged', this.onButtonChanged);\n    el.removeEventListener('buttondown', this.onButtonDown);\n    el.removeEventListener('buttonup', this.onButtonUp);\n    el.removeEventListener('touchstart', this.onButtonTouchStart);\n    el.removeEventListener('touchend', this.onButtonTouchEnd);\n    el.removeEventListener('model-loaded', this.onModelLoaded);\n    el.removeEventListener('axismove', this.onAxisMoved);\n    this.controllerEventsActive = false;\n  },\n\n  checkIfControllerPresent: function () {\n    checkControllerPresentAndSetup(this, GAMEPAD_ID_PREFIX,\n                                        this.data.hand ? {hand: this.data.hand} : {});\n  },\n\n  play: function () {\n    this.checkIfControllerPresent();\n    this.addControllersUpdateListener();\n  },\n\n  pause: function () {\n    this.removeEventListeners();\n    this.removeControllersUpdateListener();\n  },\n\n  injectTrackedControls: function () {\n    var el = this.el;\n    var data = this.data;\n    el.setAttribute('tracked-controls', {\n      armModel: data.armModel,\n      hand: data.hand,\n      idPrefix: GAMEPAD_ID_PREFIX,\n      orientationOffset: data.orientationOffset\n    });\n    if (!this.data.model) { return; }\n    this.el.setAttribute('gltf-model', OCULUS_GO_CONTROLLER_MODEL_URL);\n  },\n\n  addControllersUpdateListener: function () {\n    this.el.sceneEl.addEventListener('controllersupdated', this.onControllersUpdate, false);\n  },\n\n  removeControllersUpdateListener: function () {\n    this.el.sceneEl.removeEventListener('controllersupdated', this.onControllersUpdate, false);\n  },\n\n  onControllersUpdate: function () {\n    this.checkIfControllerPresent();\n  },\n\n  // No need for onButtonChanged, since Oculus Go controller has no analog buttons.\n\n  onModelLoaded: function (evt) {\n    var controllerObject3D = evt.detail.model;\n    var buttonMeshes;\n\n    if (!this.data.model) { return; }\n    buttonMeshes = this.buttonMeshes = {};\n    buttonMeshes.trigger = controllerObject3D.getObjectByName('oculus_go_button_trigger');\n    buttonMeshes.trackpad = controllerObject3D.getObjectByName('oculus_go_touchpad');\n  },\n\n  onButtonChanged: function (evt) {\n    var button = this.mapping.buttons[evt.detail.id];\n    if (!button) return;\n    // Pass along changed event with button state, using button mapping for convenience.\n    this.el.emit(button + 'changed', evt.detail.state);\n  },\n\n  onAxisMoved: function (evt) {\n    emitIfAxesChanged(this, this.mapping.axes, evt);\n  },\n\n  updateModel: function (buttonName, evtName) {\n    if (!this.data.model) { return; }\n    this.updateButtonModel(buttonName, evtName);\n  },\n\n  updateButtonModel: function (buttonName, state) {\n    var buttonMeshes = this.buttonMeshes;\n    if (!buttonMeshes || !buttonMeshes[buttonName]) { return; }\n    var color;\n    var button;\n    switch (state) {\n      case 'down':\n        color = this.data.buttonHighlightColor;\n        break;\n      case 'touchstart':\n        color = this.data.buttonTouchedColor;\n        break;\n      default:\n        color = this.data.buttonColor;\n    }\n    button = buttonMeshes[buttonName];\n    button.material.color.set(color);\n    this.rendererSystem.applyColorCorrection(button.material.color);\n  }\n});\n"]},"metadata":{},"sourceType":"script"}